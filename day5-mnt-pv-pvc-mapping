#first we will create an storage in the node machine
  #k8s use an file ssytem called as Union file 
  ##login to the node machine create a directory called as /mnt/data
    3  mkdir /mnt/data
    4  ls /mnt/data
###ALL this activity need to be done in the master machine
  root@k8smaster:~# nano pv.yml
apiVersion: v1 
kind: PersistentVolume
metadata:
  name: pv-volume #this is the name of the volume
spec:
  capacity:
    storage: 5Gi  #size of the volume
    
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce   #readwritemany #read 
  hostPath:
    path: "/mnt/data"
    #to save the file Press Ctrl x press y and enter
root@k8smaster:~# kubectl apply -f pv.yml
persistentvolume/pv-volume created
  #this will show that the volume is in avaiable 
root@k8smaster:~# kubectl get pv
NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-volume   5Gi        RWO            Retain           Available                          <unset>                          5s
root@k8smaster:~#

###lets create the persistent volume claim but if you see the volume show avaialbe 
  root@k8smaster:~# nano pvc.yml
apiVersion: v1 
kind: PersistentVolumeClaim
metadata:
  name: pv-claim
spec:
  resources: 
    requests:
      storage: 5Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce

root@k8smaster:~# kubectl apply -f pvc.yml
persistentvolumeclaim/pv-claim created
root@k8smaster:~# kubectl get pv
NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM              STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-volume   5Gi        RWO            Retain           Bound    default/pv-claim                  <unset>                          4m41s
root@k8smaster:~#
#lets create the secret 
root@k8smaster:~# nano secret.yml
apiVersion: v1 
kind: Secret
metadata:
  name: mysql-db-password
type: Opaque #
data:
  password: cGFzc3dvcmQxMDE= #password101 (base64 encoded)

root@k8smaster:~# kubectl apply -f secret.yml
secret/mysql-db-password created
root@k8smaster:~# kubectl get secret
NAME                TYPE     DATA   AGE
mysql-db-password   Opaque   1      7s
root@k8smaster:~#
##let create the config map
144  nano configmap.yml
apiVersion: v1 
kind: ConfigMap
metadata:
  name: userdb-creation-script
data:
  mysql_usermgmt.sql: |
    DROP DATABASE IF EXISTS webappdb;
    CREATE DATABASE webappdb;
  145  kubectl apply -f configmap.yml
  146  kubectl get configmap
  147  kubectl describe configmap userdb-creation-script
#lets create the mysql deployment 
149  nano mysql.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql 
spec:
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql 
    spec:
      containers:
      - name: myapp
        image: mysql:5.6
        env:
          - name: MYSQL_ROOT_PASSWORD
            valueFrom:
              secretKeyRef:
                name: mysql-db-password 
                key: password
        ports:
        - containerPort: 3306
        volumeMounts:
          - name: storage
            mountPath: /var/lib/mysql
          - name: usermgmt-db-script
            mountPath: /docker-entrypoint-initdb.d/
      volumes: 
        - name: storage
          persistentVolumeClaim:
            claimName: pv-claim
        - name: usermgmt-db-script
          configMap:
            name: userdb-creation-script
  150  kubectl apply -f mysql.yml
#once you applied it lets verify the describe command 
154  kubectl describe deploy mysql
###check the describe command it will show three parameters
1. environment 
2. configmap
3. PVC
####################if all good well we can login inside the mysql database using the password 
root@k8smaster:~# kubectl get pod
NAME                                   READY   STATUS    RESTARTS        AGE

mysql-9d68c55bb-frbkx                  1/1     Running   0               4m10s
nginx                                  1/1     Running   1 (5h26m ago)   24h
root@k8smaster:~# kubectl exec -it mysql-9d68c55bb-frbkx -- /bin/bash
root@mysql-9d68c55bb-frbkx:/#
#change the pod id to your id while loggin
#lets use the login of mysql password is password101
root@mysql-9d68c55bb-frbkx:/# mysql -u root -p
###once you login check the database is created or not 
show databases;
#you can see your webappdb
mysql> create database employee;
#lets visualize the db 
show databases;
exit
#now this database need to be created in /mnt/data as a folder login to the node machine and verify it
root@k8snode:~# cd /mnt/data
root@k8snode:/mnt/data# ls
auto.cnf  employee  ib_logfile0  ib_logfile1  ibdata1  mysql  performance_schema  webappdb
root@k8snode:/mnt/data#






